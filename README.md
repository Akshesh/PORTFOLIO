# Instruction to run app.

1. Build the Docker image by running the following command in the terminal from the root directory of the app

   ```bash
   cd Portfolio-Scrapy
   docker build -t portfolio-app .
   ```

   This will create a Docker image with the name "portfolio-app".
2. Run the Docker container by running the following command in the terminal

   ```bash
   docker run -p 5000:5000 -v "$(pwd)/portfolio_scraper:/app/portfolio_scraper" portfolio-app
   ```

   This will start the Docker container and map port 5000 on the host machine to port 5000 on the container. It also mounts the portfolio_scraper directory from the host machine to the container so that the JSON file generated by the scraper is available to the Flask app.
3. Open a web browser and go to http://localhost:5000/ to access the app.
4. API Endpoints:
    1. Here is an example to fetch company containing substring (autocomplete)
    ```bash
    curl --location --request GET 'http://0.0.0.0:5000/autocomplete?query=1p'
    ```
    output of above curl command:
    ```json
   {
   "https://lsvp.com/portfolio/": [
      {
         "company_domain": "1password.com",
         "company_name": "1Password"
      }
   ],
   "https://www.amplifypartners.com/portfolio": []
   }
   ```
    2. Here is an example to fetch all companies.
    ```bash
    curl --location --request GET 'http://0.0.0.0:5000/autocomplete'
    curl --location --request GET 'http://0.0.0.0:5000/autocomplete?query='
    ```
    3. If you want updated scrapy results, then execute following command
    ```bash
    curl --location --request GET 'http://0.0.0.0:5000/reload'
    ```
5. Generated output file can be viewed under 'portfolio_scraper/portfolio.json' and sample API output is as per follows.
   ```json
   [
   {"https://www.amplifypartners.com/portfolio": [{"company_domain": "actioniq.com", "company_name": "ActionIQ"}, {"company_domain": "anchorage.com", "company_name": "Anchorage"}, {"company_domain": "anyscale.com", "company_name": "Anyscale"}, {"company_domain": "archera.ai", "company_name": "Archera"}, {"company_domain": "authzed.com", "company_name": "Authzed"}, {"company_domain": "chainguard.dev", "company_name": "Chainguard"}, {"company_domain": "continual.ai", "company_name": "Continual"}, {"company_domain": "covariant.ai", "company_name": "Covariant"}, {"company_domain": "datadoghq.com", "company_name": "Datadog"}, {"company_domain": "datafold.com", "company_name": "Datafold"}, {"company_domain": "getdbt.com", "company_name": "dbt"}, {"company_domain": "diagrid.io", "company_name": "Diagrid"}, {"company_domain": "diffbot.com", "company_name": "Diffbot"}, {"company_domain": "dyndrite.com", "company_name": "Dyndrite"}, {"company_domain": "einblick.ai", "company_name": "Einblick"}, {"company_domain": "elementl.com", "company_name": "Elemntl"}, {"company_domain": "enlitic.com", "company_name": "Enlitic"}, {"company_domain": "geteppo.com", "company_name": "Eppo"}, {"company_domain": "fastly.com", "company_name": "Fastly"}, {"company_domain": "fermyon.com", "company_name": "Fermyon"}, {"company_domain": "foxglove.dev", "company_name": "Foxglove"}, {"company_domain": "higallop.com", "company_name": "Gallop"}, {"company_domain": "gantry.io", "company_name": "Gantry"}, {"company_domain": "gorgias.com", "company_name": "Gorgias"}, {"company_domain": "gremlin.com", "company_name": "Gremlin"}, {"company_domain": "hex.tech", "company_name": "Hex"}, {"company_domain": "hightouch.com", "company_name": "Hightouch"}, {"company_domain": "intellimize.com", "company_name": "Intelimize"}, {"company_domain": "intervenn.com", "company_name": "InterVenn"}, {"company_domain": "ironox.com", "company_name": "IronOx"}, {"company_domain": "lumalabs.ai", "company_name": "Luma"}, {"company_domain": "mabl.com", "company_name": "mabl"}, {"company_domain": "magic.dev", "company_name": "Magic"}, {"company_domain": "material.security", "company_name": "Material"}, {"company_domain": "maze.co", "company_name": "Maze"}, {"company_domain": "meroxa.com", "company_name": "Meroxa"}, {"company_domain": "metaphor.io", "company_name": "Metaphor"}, {"company_domain": "minerva-labs.com", "company_name": "Minerva"}, {"company_domain": "modal.com", "company_name": "Modal"}, {"company_domain": "motherduck.com", "company_name": "MotherDuck"}, {"company_domain": "near.org", "company_name": "Near"}, {"company_domain": "notablelabs.com", "company_name": "Notable"}, {"company_domain": "octoml.ai", "company_name": "OctoML"}, {"company_domain": "outerbounds.com", "company_name": "Outerbounds"}, {"company_domain": "picnichealth.com", "company_name": "PicnicHealth"}, {"company_domain": "polly.ai", "company_name": "Polly"}, {"company_domain": "primer.ai", "company_name": "Primer"}, {"company_domain": "prisma.io", "company_name": "Prisma"}, {"company_domain": "readyset.io", "company_name": "ReadySet"}, {"company_domain": "recursion.com", "company_name": "Recursion"}, {"company_domain": "replicated.com", "company_name": "Replicated"}, {"company_domain": "runwayml.com", "company_name": "Runway"}, {"company_domain": "scribehow.com", "company_name": "Scribe"}, {"company_domain": "sima.ai", "company_name": "SiMa.ai"}, {"company_domain": "sourcegraph.com", "company_name": "Sourcegraph"}, {"company_domain": "suborbital.dev", "company_name": "Suborbital"}, {"company_domain": "symops.com", "company_name": "Sym"}, {"company_domain": "temporal.io", "company_name": "Temporal"}, {"company_domain": "tigerbeetle.com", "company_name": "TigerBeetle"}, {"company_domain": "usefulsensors.com", "company_name": "Useful"}, {"company_domain": "yeshid.com", "company_name": "YeshID"}]},
   {"https://lsvp.com/portfolio/": [{"company_domain": "udaan.com", "company_name": "Udaan"}, {"company_domain": "rubrik.com", "company_name": "Rubrik"}, {"company_domain": "catonetworks.com", "company_name": "Cato Networks"}, {"company_domain": "netskope.com", "company_name": "Netskope"}, {"company_domain": "Navan.com", "company_name": "Navan"}, {"company_domain": "exabeam.com", "company_name": "Exabeam"}, {"company_domain": "faire.com", "company_name": "Faire"}, {"company_domain": "thoughtspot.com", "company_name": "ThoughtSpot"}, {"company_domain": "betterup.co", "company_name": "Betterup"}, {"company_domain": "grafana.com", "company_name": "Grafana"}, {"company_domain": "carta.com", "company_name": "Carta"}, {"company_domain": "sharechat.com", "company_name": "ShareChat"}, {"company_domain": "epicgames.com", "company_name": "Epic Games"}, {"company_domain": "1password.com", "company_name": "1Password"}, {"company_domain": "vinted.com", "company_name": "Vinted"}, {"company_domain": "multiverse.io", "company_name": "Multiverse"}, {"company_domain": "orcabio.com", "company_name": "Orca Bio"}, {"company_domain": "arcticwolf.com", "company_name": "Arctic Wolf"}, {"company_domain": "moveworks.ai", "company_name": "Moveworks"}, {"company_domain": "quantumscape.com", "company_name": "QuantumScape"}]}
   ]
   ```

## portfolio_spider.py

### Assumptions

The PortfolioSpider class assumes that there are two websites to scrape - 'https://www.amplifypartners.com/portfolio' and 'https://lsvp.com/portfolio/'. It further assumes that the HTML structure of these websites will remain consistent, and the code will work as expected if the structure changes.

### Architecture

The PortfolioSpider class is built using the Scrapy web crawling framework. It starts by defining the name and start URLs for the spider. It then defines a parse() method that extracts the list of domains for all the portfolio companies for each website. The spider first determines which website the response is for, then extracts the relevant information using CSS selectors and stores it in a dictionary.

### Data structures

The PortfolioSpider class uses a Python dictionary to store the list of domains for all the portfolio companies for each website. The dictionary has the URL of the website as the key and a list of dictionaries as the value. Each dictionary in the list represents a company and contains its name and domain.

### Testing methodology

To test the PortfolioSpider class, we can create unit tests that check if the spider is able to extract the list of domains for all the portfolio companies for each website. The unit tests can use Scrapy's built-in test classes to simulate HTTP responses and check if the spider extracts the expected information. We can also manually test the spider by running it and inspecting the output to ensure that it matches the expected output.

## app.py

### Assumptions

The app assumes that there is a Scrapy spider named 'portfolio' that scrapes the list of domains for all the portfolio companies for the two websites defined in the spider. It further assumes that the spider outputs the list of domains in JSON format and saves it to a file named 'portfolio.json' in the 'portfolio_scraper' directory.

### Architecture

The app is built using the Flask web framework. It defines three endpoints - '/autocomplete', '/reload', and '/industry'. The '/autocomplete' endpoint takes a query parameter and returns a JSON object containing a list of companies that match the query. The '/reload' endpoint runs the Scrapy spider to update the list of domains for all the portfolio companies. The '/industry' endpoint is not implemented.

The app uses the load_data() function to read the JSON file containing the list of domains and converts it to a Python object. It then uses this object to generate the response for the '/autocomplete' endpoint.

### Data structures

The app uses a Python dictionary to store the list of companies that match the query for each URL. The dictionary has the URL as the key and a list of dictionaries as the value. Each dictionary in the list represents a company and contains its name and domain.

### Testing methodology

To test the app, we can create unit tests that simulate HTTP requests and check if the app returns the expected responses. We can also manually test the app by running it and sending HTTP requests using a tool like Postman to ensure that it behaves as expected.
